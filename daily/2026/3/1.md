## 2026-03-01

### ファイルディスクリプタ

ファイルディスクリプタは、UNIX系OSで用いられるファイル識別子で０以上の整数です。

有名なファイルディスクリプタは、0(標準入力)、1(標準出力)、2 (標準エラー)があります。

これ以外にファイルディスクリプタは、プログラムがファイルをOpenされたときに採番され、Closeした際に開放されます。
※ ファイルディスクリプタが消費されるケースは通常ファイル、ログファイルTCP/UDPソケットで消費されます。

ファイルディスクリプタには上限があり、上限以上ファイルをオープンすると以下のようなエラーが発生します。

```
Too many open files
```

ファイルディスクリプタのソフトリミット

```
sh-4.2$ ulimit -Sn
65535
```

ファイルディスクリプタのハードリミット

```
sh-4.2$ ulimit -Hn
93486 
```

現在使用中のファイルディスクリプタ数確認

```
ls /proc/self/fd | wc -l
4
```

全プロセスが開いているファイルをすべて表示

```
sh-4.2$ lsof | head
COMMAND    PID  TID           USER   FD      TYPE DEVICE  SIZE/OFF     NODE NAME
systemd      1                root  cwd   unknown                           /proc/1/cwd (readlink: Permission denied)
systemd      1                root  rtd   unknown                           /proc/1/root (readlink: Permission denied)
systemd      1                root  txt   unknown                           /proc/1/exe (readlink: Permission denied)
systemd      1                root NOFD                                     /proc/1/fd (opendir: Permission denied)
kthreadd     2                root  cwd   unknown                           /proc/2/cwd (readlink: Permission denied)
kthreadd     2                root  rtd   unknown                           /proc/2/root (readlink: Permission denied)
kthreadd     2                root  txt   unknown                           /proc/2/exe (readlink: Permission denied)
kthreadd     2                root NOFD                                     /proc/2/fd (opendir: Permission denied)
rcu_gp       3                root  cwd   unknown                           /proc/3/cwd (readlink: Permission denied)
```